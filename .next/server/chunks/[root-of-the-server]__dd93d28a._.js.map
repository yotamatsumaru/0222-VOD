{"version":3,"sources":["../../../lib/db.ts"],"sourcesContent":["import { Pool, QueryResult, QueryResultRow } from 'pg';\n\nlet pool: Pool | null = null;\n\nexport function getDatabase(): Pool {\n  if (!pool) {\n    pool = new Pool({\n      connectionString: process.env.DATABASE_URL,\n      max: 20,\n      idleTimeoutMillis: 30000,\n      connectionTimeoutMillis: 2000,\n    });\n  }\n  return pool;\n}\n\nexport async function query<T extends QueryResultRow = any>(\n  text: string,\n  params?: any[]\n): Promise<QueryResult<T>> {\n  const db = getDatabase();\n  return db.query<T>(text, params);\n}\n\nexport async function getOne<T extends QueryResultRow = any>(\n  text: string,\n  params?: any[]\n): Promise<T | null> {\n  const result = await query<T>(text, params);\n  return result.rows[0] || null;\n}\n\nexport async function getAll<T extends QueryResultRow = any>(\n  text: string,\n  params?: any[]\n): Promise<T[]> {\n  const result = await query<T>(text, params);\n  return result.rows;\n}\n\nexport async function insert<T extends QueryResultRow = any>(\n  text: string,\n  params?: any[]\n): Promise<T> {\n  const result = await query<T>(text, params);\n  return result.rows[0];\n}\n\nexport async function update<T extends QueryResultRow = any>(\n  text: string,\n  params?: any[]\n): Promise<T | null> {\n  const result = await query<T>(text, params);\n  return result.rows[0] || null;\n}\n\nexport async function remove(text: string, params?: any[]): Promise<boolean> {\n  const result = await query(text, params);\n  return result.rowCount !== null && result.rowCount > 0;\n}\n"],"names":[],"mappings":"8CAAA,IAAA,EAAA,EAAA,CAAA,CAAA,yCAEA,IAAI,EAAoB,KAcjB,eAAe,EACpB,CAAY,CACZ,CAAc,EAGd,MAAO,CAhBH,CAAC,IACH,EADS,AACF,IAAI,EAAA,IAAI,CAAC,CACd,iBAAkB,QAAQ,GAAG,CAAC,YAAY,CAC1C,IAAK,GACL,kBAAmB,IACnB,wBAAyB,GAC3B,EAAA,EAEK,GAQG,KAAK,CAAI,EAAM,EAC3B,CAEO,eAAe,EACpB,CAAY,CACZ,CAAc,EAGd,MAAO,CADQ,MAAM,EAAS,EAAM,EAAA,EACtB,IAAI,CAAC,EAAE,EAAI,IAC3B,CAEO,eAAe,EACpB,CAAY,CACZ,CAAc,EAGd,MAAO,CADQ,MAAM,EAAS,EAAM,EAAA,EACtB,IAAI,AACpB,CAEO,eAAe,EACpB,CAAY,CACZ,CAAc,EAGd,MAAO,CADQ,MAAM,EAAS,EAAM,EAAA,EACtB,IAAI,CAAC,EAAE,AACvB,CAEO,eAAe,EACpB,CAAY,CACZ,CAAc,EAGd,MAAO,CADQ,MAAM,EAAS,EAAM,EAAA,EACtB,IAAI,CAAC,EAAE,EAAI,IAC3B,CAEO,eAAe,EAAO,CAAY,CAAE,CAAc,EACvD,IAAM,EAAS,MAAM,EAAM,EAAM,GACjC,OAA2B,OAApB,EAAO,QAAQ,EAAa,EAAO,QAAQ,CAAG,CACvD"}