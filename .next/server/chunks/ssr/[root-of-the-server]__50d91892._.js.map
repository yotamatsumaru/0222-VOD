{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/hooks-client-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/server-inserted-html.ts","../../../../node_modules/next/src/server/route-modules/app-page/module.compiled.js","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/app-router-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-server-dom-turbopack-client.ts","../../../../app/mypage/page.tsx"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].HooksClientContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].ServerInsertedHtml\n","if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].AppRouterContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactServerDOMTurbopackClient\n","'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport { getAuthToken, getAuthHeaders } from '@/lib/userAuth';\n\ninterface Purchase {\n  id: number;\n  event_id: number;\n  event_title: string;\n  event_slug: string;\n  ticket_name: string;\n  amount: number;\n  currency: string;\n  status: string;\n  purchased_at: string;\n  access_token: string | null;\n  token_expires_at: string | null;\n}\n\nexport default function MyPage() {\n  const [purchases, setPurchases] = useState<Purchase[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const [userName, setUserName] = useState('');\n  const [mounted, setMounted] = useState(false);\n  const router = useRouter();\n\n  // First useEffect: Handle mounting\n  useEffect(() => {\n    console.log('[MyPage] Component mounted');\n    setMounted(true);\n  }, []);\n\n  // Second useEffect: Handle authentication and data fetching\n  useEffect(() => {\n    if (!mounted) {\n      console.log('[MyPage] Not mounted yet, skipping auth check');\n      return;\n    }\n\n    // Add a small delay to ensure localStorage is accessible\n    const checkAuth = async () => {\n      console.log('[MyPage] Checking authentication');\n      \n      // Use the correct auth helper function\n      const token = getAuthToken();\n      console.log('[MyPage] Token exists:', !!token);\n      console.log('[MyPage] Token value:', token ? token.substring(0, 20) + '...' : 'null');\n    \n      if (!token) {\n        console.log('[MyPage] No token, redirecting to login');\n        router.push('/login?redirect=/mypage');\n        return;\n      }\n\n      console.log('[MyPage] Fetching user info and purchases');\n\n      // Fetch user info using auth headers\n      fetch('/api/auth/me', {\n        headers: getAuthHeaders() as HeadersInit,\n      })\n        .then(res => {\n          console.log('[MyPage] User info response:', res.status);\n          return res.json();\n        })\n        .then(data => {\n          console.log('[MyPage] User data:', data);\n          if (data.user) {\n            setUserName(data.user.name || data.user.email);\n          }\n        })\n        .catch(err => console.error('[MyPage] Failed to fetch user:', err));\n\n      // Fetch user purchases using auth headers\n      fetch('/api/purchases/my', {\n        headers: getAuthHeaders() as HeadersInit,\n      })\n        .then(res => {\n          console.log('[MyPage] Purchases response:', res.status);\n          if (!res.ok) {\n            throw new Error('Failed to fetch purchases');\n          }\n          return res.json();\n        })\n        .then(data => {\n          console.log('[MyPage] Purchases data:', data);\n          setPurchases(data.purchases || []);\n          setLoading(false);\n        })\n        .catch(err => {\n          console.error('[MyPage] Error fetching purchases:', err);\n          setError('購入履歴の取得に失敗しました');\n          setLoading(false);\n        });\n    };\n\n    checkAuth();\n  }, [mounted, router]);\n\n  // Don't render anything until mounted\n  if (!mounted) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-white text-xl\">読み込み中...</div>\n      </div>\n    );\n  }\n\n  const handleLogout = () => {\n    if (typeof window !== 'undefined') {\n      localStorage.removeItem('auth_token');\n    }\n    router.push('/');\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('ja-JP', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit',\n    });\n  };\n\n  const formatPrice = (amount: number, currency: string) => {\n    return new Intl.NumberFormat('ja-JP', {\n      style: 'currency',\n      currency: currency.toUpperCase(),\n    }).format(amount / 100);\n  };\n\n  const isTokenValid = (expiresAt: string | null) => {\n    if (!expiresAt) return false;\n    return new Date(expiresAt) > new Date();\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-white text-xl\">読み込み中...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen py-12 px-4\">\n      <div className=\"max-w-6xl mx-auto\">\n        {/* Header */}\n        <div className=\"bg-white/10 backdrop-blur-md rounded-2xl p-8 mb-8\">\n          <div className=\"flex justify-between items-center\">\n            <div>\n              <h1 className=\"text-4xl font-bold text-white mb-2\">マイページ</h1>\n              <p className=\"text-white/70\">\n                ようこそ、{userName || 'ゲスト'}さん\n              </p>\n            </div>\n            <button\n              onClick={handleLogout}\n              className=\"px-6 py-3 bg-white/20 hover:bg-white/30 text-white rounded-lg transition-all\"\n            >\n              ログアウト\n            </button>\n          </div>\n        </div>\n\n        {/* Purchases List */}\n        <div className=\"bg-white/10 backdrop-blur-md rounded-2xl p-8\">\n          <h2 className=\"text-2xl font-bold text-white mb-6\">購入履歴</h2>\n\n          {error && (\n            <div className=\"bg-red-500/20 border border-red-500/50 text-white rounded-lg p-4 mb-6\">\n              {error}\n            </div>\n          )}\n\n          {purchases.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <p className=\"text-white/70 text-lg mb-6\">\n                購入履歴がありません\n              </p>\n              <Link\n                href=\"/events\"\n                className=\"inline-block px-8 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all\"\n              >\n                イベントを探す\n              </Link>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {purchases.map((purchase) => (\n                <div\n                  key={purchase.id}\n                  className=\"bg-white/5 border border-white/10 rounded-xl p-6 hover:bg-white/10 transition-all\"\n                >\n                  <div className=\"flex justify-between items-start mb-4\">\n                    <div className=\"flex-1\">\n                      <h3 className=\"text-xl font-semibold text-white mb-2\">\n                        {purchase.event_title}\n                      </h3>\n                      <p className=\"text-white/70 mb-1\">\n                        チケット: {purchase.ticket_name}\n                      </p>\n                      <p className=\"text-white/70 text-sm\">\n                        購入日時: {formatDate(purchase.purchased_at)}\n                      </p>\n                    </div>\n                    <div className=\"text-right\">\n                      <div className=\"text-2xl font-bold text-white mb-2\">\n                        {formatPrice(purchase.amount, purchase.currency)}\n                      </div>\n                      <span\n                        className={`inline-block px-3 py-1 rounded-full text-sm ${\n                          purchase.status === 'completed'\n                            ? 'bg-green-500/20 text-green-300'\n                            : purchase.status === 'refunded'\n                            ? 'bg-red-500/20 text-red-300'\n                            : 'bg-yellow-500/20 text-yellow-300'\n                        }`}\n                      >\n                        {purchase.status === 'completed'\n                          ? '購入済み'\n                          : purchase.status === 'refunded'\n                          ? '返金済み'\n                          : '処理中'}\n                      </span>\n                    </div>\n                  </div>\n\n                  <div className=\"flex gap-4\">\n                    <Link\n                      href={`/events/${purchase.event_slug}`}\n                      className=\"px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-all\"\n                    >\n                      イベント詳細\n                    </Link>\n                    {purchase.access_token &&\n                      isTokenValid(purchase.token_expires_at) &&\n                      purchase.status === 'completed' && (\n                        <Link\n                          href={`/watch/${purchase.event_slug}?token=${purchase.access_token}`}\n                          className=\"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all\"\n                        >\n                          視聴する\n                        </Link>\n                      )}\n                    {purchase.token_expires_at &&\n                      !isTokenValid(purchase.token_expires_at) && (\n                        <span className=\"px-4 py-2 bg-gray-500/20 text-gray-400 rounded-lg\">\n                          視聴期限切れ\n                        </span>\n                      )}\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["module","exports","require","vendored","HooksClientContext","ServerInsertedHtml","process","env","NEXT_RUNTIME","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","ReactJsxRuntime","React","AppRouterContext","ReactServerDOMTurbopackClient"],"mappings":"6CAAAA,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRC,QAAQ,CAAC,QAAW,CAACC,kBAAkB,+BCFzCJ,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRC,QAAQ,CAAC,QAAW,CAACE,kBAAkB,+sBCwBjCL,EAAOC,OAAO,CAAGC,EAAQ,CAAA,CAAA,IAAA,gCC1BjCF,GAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRC,QAAQ,CAAC,YAAY,CAAES,eAAe,+BCFxCZ,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRC,QAAQ,CAAC,YAAY,CAAEU,KAAK,8BCF9Bb,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRC,QAAQ,CAAC,QAAW,CAACW,gBAAgB,+BCFvCd,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRC,QAAQ,CAAC,YAAY,CAAEY,6BAA6B,gSCAtD,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAgBe,SAAS,IACtB,GAAM,CAAC,EAAW,EAAa,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAa,EAAE,EACnD,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACjC,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IAC7B,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACnC,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACjC,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IA2ExB,GAxEA,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,QAAQ,GAAG,CAAC,8BACZ,GAAW,EACb,EAAG,EAAE,EAGL,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,AAAK,EA6DL,CAvDkB,CANd,KAAU,IAOZ,QAAQ,GAAG,CAAC,oCAGZ,IAAM,EAAQ,CAAA,EAAA,EAAA,YAAA,AAAY,IAI1B,GAHA,QAAQ,GAAG,CAAC,yBAA0B,CAAC,CAAC,GACxC,QAAQ,GAAG,CAAC,wBAAyB,EAAQ,EAAM,SAAS,CAAC,EAAG,IAAM,MAAQ,QAE1E,CAAC,EAAO,CACV,QAAQ,GAAG,CAAC,2CACZ,EAAO,IAAI,CAAC,2BACZ,MACF,CAEA,QAAQ,GAAG,CAAC,6CAGZ,MAAM,eAAgB,CACpB,QAAS,CAAA,EAAA,EAAA,cAAA,AAAc,GACzB,GACG,IAAI,CAAC,IACJ,QAAQ,GAAG,CAAC,+BAAgC,EAAI,MAAM,EAC/C,EAAI,IAAI,KAEhB,IAAI,CAAC,IACJ,QAAQ,GAAG,CAAC,sBAAuB,GAC/B,EAAK,IAAI,EAAE,AACb,EAAY,EAAK,IAAI,CAAC,IAAI,EAAI,EAAK,IAAI,CAAC,KAAK,CAEjD,GACC,KAAK,CAAC,GAAO,QAAQ,KAAK,CAAC,iCAAkC,IAGhE,MAAM,oBAAqB,CACzB,QAAS,CAAA,EAAA,EAAA,cAAA,AAAc,GACzB,GACG,IAAI,CAAC,IAEJ,GADA,QAAQ,GAAG,CAAC,+BAAgC,EAAI,MAAM,EAClD,CAAC,EAAI,EAAE,CACT,CADW,KACL,AAAI,MAAM,6BAElB,OAAO,EAAI,IAAI,EACjB,GACC,IAAI,CAAC,IACJ,QAAQ,GAAG,CAAC,2BAA4B,GACxC,EAAa,EAAK,SAAS,EAAI,EAAE,EACjC,GAAW,EACb,GACC,KAAK,CAAC,IACL,QAAQ,KAAK,CAAC,qCAAsC,GACpD,EAAS,kBACT,GAAW,EACb,GACJ,IA1DE,QAAQ,GAAG,CAAC,gDA6DhB,EAAG,CAAC,EAAS,EAAO,EAGhB,CAAC,EACH,MACE,CAFU,AAEV,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yDACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,8BAAqB,eA6B1C,IAAM,EAAe,AAAC,GACpB,CAAI,CAAC,GACE,IAAI,IADK,CACA,GAAa,GADN,CACU,YAGnC,AAAI,EAEA,CAAA,EAAA,EAAA,EAFS,CAET,EAAC,MAAA,CAAI,UAAU,yDACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,8BAAqB,eAMxC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,mCACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8BAEb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,6DACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8CACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,8CAAqC,UACnD,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,0BAAgB,QACrB,GAAY,MAAM,WAG5B,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,QAlDS,CAkDA,IA9CnB,EAAO,IAAI,CAAC,IACd,EA8CY,UAAU,wFACX,eAOL,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,yDACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,8CAAqC,SAElD,GACC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iFACZ,IAIJ,AAAqB,MAAX,MAAM,CACf,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8BACb,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,sCAA6B,eAG1C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CACH,KAAK,UACL,UAAU,yGACX,eAKH,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,qBACZ,EAAU,GAAG,CAAC,AAAC,kBACd,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAEC,UAAU,8FAEV,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,kDACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mBACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,iDACX,EAAS,WAAW,GAEvB,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,+BAAqB,SACzB,EAAS,WAAW,IAE7B,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,kCAAwB,SAvFhD,IAAI,KAAK,AAwFsB,EAAS,YAAY,EAxF/B,kBAAkB,CAAC,QAAS,CACtD,KAAM,UACN,MAAO,OACP,IAAK,UACL,KAAM,UACN,OAAQ,SACV,SAqFgB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,uBACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,+CACZ,AApFF,EAoFc,EAAS,MAAM,CApFb,EAoFe,EAAS,QAAQ,CAnF5D,IAAI,KAAK,YAAY,CAAC,QAAS,CACpC,MAAO,WACP,SAAU,EAAS,WAAW,EAChC,GAAG,MAAM,CAAC,EAAS,QAkFD,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CACC,UAAW,CAAC,4CAA4C,EAClC,cAApB,EAAS,MAAM,CACX,iCACoB,aAApB,EAAS,MAAM,CACf,6BACA,mCAAA,CACJ,UAED,AAAoB,gBAAX,MAAM,CACZ,OACoB,aAApB,EAAS,MAAM,CACf,OACA,cAKV,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,uBACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CACH,KAAM,CAAC,QAAQ,EAAE,EAAS,UAAU,CAAA,CAAE,CACtC,UAAU,wFACX,WAGA,EAAS,YAAY,EACpB,EAAa,EAAS,gBAAgB,GAClB,cAApB,EAAS,MAAM,EACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CACH,KAAM,CAAC,OAAO,EAAE,EAAS,UAAU,CAAC,OAAO,EAAE,EAAS,YAAY,CAAA,CAAE,CACpE,UAAU,4FACX,SAIJ,EAAS,gBAAgB,EACxB,CAAC,EAAa,EAAS,gBAAgB,GACrC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,6DAAoD,gBAxDrE,EAAS,EAAE,aAqElC","ignoreList":[0,1,2,3,4,5,6]}