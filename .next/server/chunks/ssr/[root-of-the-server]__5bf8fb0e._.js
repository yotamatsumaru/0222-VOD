module.exports=[36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},38783,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactServerDOMTurbopackClient},79956,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(38246);function f(){let[a,f]=(0,c.useState)([]),[g,h]=(0,c.useState)(!0),[i,j]=(0,c.useState)(""),[k,l]=(0,c.useState)(""),m=(0,d.useRouter)();(0,c.useEffect)(()=>{console.log("[MyPage] Component mounted");let a=localStorage.getItem("authToken");if(console.log("[MyPage] Token exists:",!!a),!a){console.log("[MyPage] No token, redirecting to login"),m.push("/login?redirect=/mypage");return}console.log("[MyPage] Fetching user info and purchases"),fetch("/api/auth/me",{headers:{Authorization:`Bearer ${a}`}}).then(a=>(console.log("[MyPage] User info response:",a.status),a.json())).then(a=>{console.log("[MyPage] User data:",a),a.user&&l(a.user.name||a.user.email)}).catch(a=>console.error("[MyPage] Failed to fetch user:",a)),fetch("/api/purchases/my",{headers:{Authorization:`Bearer ${a}`}}).then(a=>{if(console.log("[MyPage] Purchases response:",a.status),!a.ok)throw Error("Failed to fetch purchases");return a.json()}).then(a=>{console.log("[MyPage] Purchases data:",a),f(a.purchases||[]),h(!1)}).catch(a=>{console.error("[MyPage] Error fetching purchases:",a),j("購入履歴の取得に失敗しました"),h(!1)})},[m]);let n=a=>!!a&&new Date(a)>new Date;return g?(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,b.jsx)("div",{className:"text-white text-xl",children:"読み込み中..."})}):(0,b.jsx)("div",{className:"min-h-screen py-12 px-4",children:(0,b.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,b.jsx)("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-8 mb-8",children:(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-4xl font-bold text-white mb-2",children:"マイページ"}),(0,b.jsxs)("p",{className:"text-white/70",children:["ようこそ、",k||"ゲスト","さん"]})]}),(0,b.jsx)("button",{onClick:()=>{localStorage.removeItem("authToken"),m.push("/")},className:"px-6 py-3 bg-white/20 hover:bg-white/30 text-white rounded-lg transition-all",children:"ログアウト"})]})}),(0,b.jsxs)("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-8",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-white mb-6",children:"購入履歴"}),i&&(0,b.jsx)("div",{className:"bg-red-500/20 border border-red-500/50 text-white rounded-lg p-4 mb-6",children:i}),0===a.length?(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)("p",{className:"text-white/70 text-lg mb-6",children:"購入履歴がありません"}),(0,b.jsx)(e.default,{href:"/events",className:"inline-block px-8 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all",children:"イベントを探す"})]}):(0,b.jsx)("div",{className:"space-y-4",children:a.map(a=>{let c,d;return(0,b.jsxs)("div",{className:"bg-white/5 border border-white/10 rounded-xl p-6 hover:bg-white/10 transition-all",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"text-xl font-semibold text-white mb-2",children:a.event_title}),(0,b.jsxs)("p",{className:"text-white/70 mb-1",children:["チケット: ",a.ticket_name]}),(0,b.jsxs)("p",{className:"text-white/70 text-sm",children:["購入日時: ",new Date(a.purchased_at).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-white mb-2",children:(c=a.amount,d=a.currency,new Intl.NumberFormat("ja-JP",{style:"currency",currency:d.toUpperCase()}).format(c/100))}),(0,b.jsx)("span",{className:`inline-block px-3 py-1 rounded-full text-sm ${"completed"===a.status?"bg-green-500/20 text-green-300":"refunded"===a.status?"bg-red-500/20 text-red-300":"bg-yellow-500/20 text-yellow-300"}`,children:"completed"===a.status?"購入済み":"refunded"===a.status?"返金済み":"処理中"})]})]}),(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)(e.default,{href:`/events/${a.event_slug}`,className:"px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-all",children:"イベント詳細"}),a.access_token&&n(a.token_expires_at)&&"completed"===a.status&&(0,b.jsx)(e.default,{href:`/watch/${a.event_slug}?token=${a.access_token}`,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all",children:"視聴する"}),a.token_expires_at&&!n(a.token_expires_at)&&(0,b.jsx)("span",{className:"px-4 py-2 bg-gray-500/20 text-gray-400 rounded-lg",children:"視聴期限切れ"})]})]},a.id)})})]})]})})}a.s(["default",()=>f])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__5bf8fb0e._.js.map