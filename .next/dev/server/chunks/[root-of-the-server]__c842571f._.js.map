{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/user/webapp/lib/adminAuth.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport bcrypt from 'bcryptjs';\n\nexport async function basicAuth(request: NextRequest): Promise<NextResponse | null> {\n  const authHeader = request.headers.get('authorization');\n\n  if (!authHeader || !authHeader.startsWith('Basic ')) {\n    return new NextResponse('Authentication required', {\n      status: 401,\n      headers: {\n        'WWW-Authenticate': 'Basic realm=\"Admin Area\"',\n      },\n    });\n  }\n\n  const base64Credentials = authHeader.split(' ')[1];\n  const credentials = Buffer.from(base64Credentials, 'base64').toString('utf-8');\n  const [username, password] = credentials.split(':');\n\n  const validUsername = process.env.ADMIN_USERNAME || 'admin';\n  const validPassword = process.env.ADMIN_PASSWORD || 'admin123';\n\n  // Simple comparison for now (in production, use bcrypt comparison with DB)\n  if (username === validUsername && password === validPassword) {\n    return null; // Authentication successful\n  }\n\n  return new NextResponse('Invalid credentials', {\n    status: 401,\n    headers: {\n      'WWW-Authenticate': 'Basic realm=\"Admin Area\"',\n    },\n  });\n}\n\nexport function requireAuth<T extends any[]>(\n  handler: (request: NextRequest, ...args: T) => Promise<Response>\n) {\n  return async (request: NextRequest, ...args: T) => {\n    const authError = await basicAuth(request);\n    if (authError) {\n      return authError;\n    }\n    return handler(request, ...args);\n  };\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAGO,eAAe,UAAU,OAAoB;IAClD,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IAEvC,IAAI,CAAC,cAAc,CAAC,WAAW,UAAU,CAAC,WAAW;QACnD,OAAO,IAAI,gJAAY,CAAC,2BAA2B;YACjD,QAAQ;YACR,SAAS;gBACP,oBAAoB;YACtB;QACF;IACF;IAEA,MAAM,oBAAoB,WAAW,KAAK,CAAC,IAAI,CAAC,EAAE;IAClD,MAAM,cAAc,OAAO,IAAI,CAAC,mBAAmB,UAAU,QAAQ,CAAC;IACtE,MAAM,CAAC,UAAU,SAAS,GAAG,YAAY,KAAK,CAAC;IAE/C,MAAM,gBAAgB,QAAQ,GAAG,CAAC,cAAc,IAAI;IACpD,MAAM,gBAAgB,QAAQ,GAAG,CAAC,cAAc,IAAI;IAEpD,2EAA2E;IAC3E,IAAI,aAAa,iBAAiB,aAAa,eAAe;QAC5D,OAAO,MAAM,4BAA4B;IAC3C;IAEA,OAAO,IAAI,gJAAY,CAAC,uBAAuB;QAC7C,QAAQ;QACR,SAAS;YACP,oBAAoB;QACtB;IACF;AACF;AAEO,SAAS,YACd,OAAgE;IAEhE,OAAO,OAAO,SAAsB,GAAG;QACrC,MAAM,YAAY,MAAM,UAAU;QAClC,IAAI,WAAW;YACb,OAAO;QACT;QACA,OAAO,QAAQ,YAAY;IAC7B;AACF"}},
    {"offset": {"line": 95, "column": 0}, "map": {"version":3,"sources":["file:///home/user/webapp/lib/db.ts"],"sourcesContent":["import { Pool, QueryResult, QueryResultRow } from 'pg';\n\nlet pool: Pool | null = null;\n\nexport function getDatabase(): Pool {\n  if (!pool) {\n    pool = new Pool({\n      connectionString: process.env.DATABASE_URL,\n      max: 20,\n      idleTimeoutMillis: 30000,\n      connectionTimeoutMillis: 2000,\n    });\n  }\n  return pool;\n}\n\nexport async function query<T extends QueryResultRow = any>(\n  text: string,\n  params?: any[]\n): Promise<QueryResult<T>> {\n  const db = getDatabase();\n  return db.query<T>(text, params);\n}\n\nexport async function getOne<T extends QueryResultRow = any>(\n  text: string,\n  params?: any[]\n): Promise<T | null> {\n  const result = await query<T>(text, params);\n  return result.rows[0] || null;\n}\n\nexport async function getAll<T extends QueryResultRow = any>(\n  text: string,\n  params?: any[]\n): Promise<T[]> {\n  const result = await query<T>(text, params);\n  return result.rows;\n}\n\nexport async function insert<T extends QueryResultRow = any>(\n  text: string,\n  params?: any[]\n): Promise<T> {\n  const result = await query<T>(text, params);\n  return result.rows[0];\n}\n\nexport async function update<T extends QueryResultRow = any>(\n  text: string,\n  params?: any[]\n): Promise<T | null> {\n  const result = await query<T>(text, params);\n  return result.rows[0] || null;\n}\n\nexport async function remove(text: string, params?: any[]): Promise<boolean> {\n  const result = await query(text, params);\n  return result.rowCount !== null && result.rowCount > 0;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;;;;;;AAEA,IAAI,OAAoB;AAEjB,SAAS;IACd,IAAI,CAAC,MAAM;QACT,OAAO,IAAI,qJAAI,CAAC;YACd,kBAAkB,QAAQ,GAAG,CAAC,YAAY;YAC1C,KAAK;YACL,mBAAmB;YACnB,yBAAyB;QAC3B;IACF;IACA,OAAO;AACT;AAEO,eAAe,MACpB,IAAY,EACZ,MAAc;IAEd,MAAM,KAAK;IACX,OAAO,GAAG,KAAK,CAAI,MAAM;AAC3B;AAEO,eAAe,OACpB,IAAY,EACZ,MAAc;IAEd,MAAM,SAAS,MAAM,MAAS,MAAM;IACpC,OAAO,OAAO,IAAI,CAAC,EAAE,IAAI;AAC3B;AAEO,eAAe,OACpB,IAAY,EACZ,MAAc;IAEd,MAAM,SAAS,MAAM,MAAS,MAAM;IACpC,OAAO,OAAO,IAAI;AACpB;AAEO,eAAe,OACpB,IAAY,EACZ,MAAc;IAEd,MAAM,SAAS,MAAM,MAAS,MAAM;IACpC,OAAO,OAAO,IAAI,CAAC,EAAE;AACvB;AAEO,eAAe,OACpB,IAAY,EACZ,MAAc;IAEd,MAAM,SAAS,MAAM,MAAS,MAAM;IACpC,OAAO,OAAO,IAAI,CAAC,EAAE,IAAI;AAC3B;AAEO,eAAe,OAAO,IAAY,EAAE,MAAc;IACvD,MAAM,SAAS,MAAM,MAAM,MAAM;IACjC,OAAO,OAAO,QAAQ,KAAK,QAAQ,OAAO,QAAQ,GAAG;AACvD"}},
    {"offset": {"line": 160, "column": 0}, "map": {"version":3,"sources":["file:///home/user/webapp/app/api/admin/stats/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { requireAuth } from '@/lib/adminAuth';\nimport { getOne } from '@/lib/db';\n\nasync function handler(request: NextRequest) {\n  try {\n    // Get total revenue\n    const revenueResult = await getOne<{ total_revenue: number }>(\n      `SELECT COALESCE(SUM(amount), 0) as total_revenue \n       FROM purchases \n       WHERE status = 'completed'`\n    );\n\n    // Get total purchases\n    const purchasesResult = await getOne<{ total_purchases: number }>(\n      `SELECT COUNT(*) as total_purchases \n       FROM purchases \n       WHERE status = 'completed'`\n    );\n\n    // Get total events\n    const eventsResult = await getOne<{ total_events: number }>(\n      'SELECT COUNT(*) as total_events FROM events'\n    );\n\n    // Get total artists\n    const artistsResult = await getOne<{ total_artists: number }>(\n      'SELECT COUNT(*) as total_artists FROM artists'\n    );\n\n    // Get recent purchases (last 10)\n    const recentPurchases = await getOne(\n      `SELECT \n        p.id,\n        p.customer_email,\n        p.customer_name,\n        p.amount,\n        p.currency,\n        p.purchased_at,\n        e.title as event_title,\n        t.name as ticket_name\n       FROM purchases p\n       LEFT JOIN events e ON p.event_id = e.id\n       LEFT JOIN tickets t ON p.ticket_id = t.id\n       WHERE p.status = 'completed'\n       ORDER BY p.purchased_at DESC\n       LIMIT 10`\n    );\n\n    // Get event sales breakdown\n    const eventSales = await getOne(\n      `SELECT \n        e.id,\n        e.title,\n        COUNT(p.id) as purchase_count,\n        COALESCE(SUM(p.amount), 0) as total_revenue\n       FROM events e\n       LEFT JOIN purchases p ON e.id = p.event_id AND p.status = 'completed'\n       GROUP BY e.id, e.title\n       ORDER BY total_revenue DESC\n       LIMIT 10`\n    );\n\n    return NextResponse.json({\n      totalRevenue: revenueResult?.total_revenue || 0,\n      totalPurchases: purchasesResult?.total_purchases || 0,\n      totalEvents: eventsResult?.total_events || 0,\n      totalArtists: artistsResult?.total_artists || 0,\n      recentPurchases: recentPurchases || [],\n      eventSales: eventSales || [],\n    });\n  } catch (error) {\n    console.error('Admin stats error:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch statistics' },\n      { status: 500 }\n    );\n  }\n}\n\nexport const GET = requireAuth(handler);\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;AAEA,eAAe,QAAQ,OAAoB;IACzC,IAAI;QACF,oBAAoB;QACpB,MAAM,gBAAgB,MAAM,IAAA,qHAAM,EAChC,CAAC;;iCAE0B,CAAC;QAG9B,sBAAsB;QACtB,MAAM,kBAAkB,MAAM,IAAA,qHAAM,EAClC,CAAC;;iCAE0B,CAAC;QAG9B,mBAAmB;QACnB,MAAM,eAAe,MAAM,IAAA,qHAAM,EAC/B;QAGF,oBAAoB;QACpB,MAAM,gBAAgB,MAAM,IAAA,qHAAM,EAChC;QAGF,iCAAiC;QACjC,MAAM,kBAAkB,MAAM,IAAA,qHAAM,EAClC,CAAC;;;;;;;;;;;;;;eAcQ,CAAC;QAGZ,4BAA4B;QAC5B,MAAM,aAAa,MAAM,IAAA,qHAAM,EAC7B,CAAC;;;;;;;;;eASQ,CAAC;QAGZ,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,cAAc,eAAe,iBAAiB;YAC9C,gBAAgB,iBAAiB,mBAAmB;YACpD,aAAa,cAAc,gBAAgB;YAC3C,cAAc,eAAe,iBAAiB;YAC9C,iBAAiB,mBAAmB,EAAE;YACtC,YAAY,cAAc,EAAE;QAC9B;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA6B,GACtC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,MAAM,MAAM,IAAA,iIAAW,EAAC"}}]
}