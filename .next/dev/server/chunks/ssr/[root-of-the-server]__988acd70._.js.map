{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///home/user/webapp/components/admin/EventsManager.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\n\ninterface Event {\n  id: number;\n  title: string;\n  slug: string;\n  status: string;\n  start_time: string;\n  artist_name: string;\n}\n\ninterface Artist {\n  id: number;\n  name: string;\n}\n\nexport default function EventsManager() {\n  const [events, setEvents] = useState<Event[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showModal, setShowModal] = useState(false);\n  const [editingEvent, setEditingEvent] = useState<Event | null>(null);\n\n  useEffect(() => {\n    fetchEvents();\n  }, []);\n\n  const fetchEvents = async () => {\n    try {\n      const credentials = sessionStorage.getItem('admin_credentials');\n      const response = await fetch('/api/admin/events', {\n        headers: {\n          'Authorization': `Basic ${credentials}`\n        }\n      });\n      \n      if (!response.ok) {\n        throw new Error('Failed to fetch events');\n      }\n      \n      const data = await response.json();\n      setEvents(Array.isArray(data) ? data : []);\n    } catch (error) {\n      console.error('Failed to fetch events:', error);\n      setEvents([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDelete = async (id: number) => {\n    if (!confirm('このイベントを削除してもよろしいですか？')) return;\n\n    try {\n      const credentials = sessionStorage.getItem('admin_credentials');\n      const response = await fetch(`/api/admin/events/${id}`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Basic ${credentials}`\n        }\n      });\n\n      if (response.ok) {\n        fetchEvents();\n      } else {\n        alert('削除に失敗しました');\n      }\n    } catch (error) {\n      console.error('Delete error:', error);\n      alert('削除に失敗しました');\n    }\n  };\n\n  const handleStatusUpdate = async (id: number, newStatus: string) => {\n    try {\n      const credentials = sessionStorage.getItem('admin_credentials');\n      const response = await fetch(`/api/admin/events/${id}`, {\n        method: 'PATCH',\n        headers: { \n          'Content-Type': 'application/json',\n          'Authorization': `Basic ${credentials}`\n        },\n        body: JSON.stringify({ status: newStatus }),\n      });\n\n      if (response.ok) {\n        fetchEvents();\n      } else {\n        alert('更新に失敗しました');\n      }\n    } catch (error) {\n      console.error('Update error:', error);\n      alert('更新に失敗しました');\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"text-center py-8\">\n        <i className=\"fas fa-spinner fa-spin text-4xl text-purple-500 mb-4\"></i>\n        <p className=\"text-gray-300\">読み込み中...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-2xl font-bold text-white\">\n          <i className=\"fas fa-calendar-alt text-purple-500 mr-2\"></i>\n          イベント管理\n        </h2>\n        <button\n          onClick={() => {\n            setEditingEvent(null);\n            setShowModal(true);\n          }}\n          className=\"bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-lg transition\"\n        >\n          <i className=\"fas fa-plus mr-2\"></i>\n          新規作成\n        </button>\n      </div>\n\n      <div className=\"bg-black bg-opacity-40 backdrop-blur-md rounded-xl border border-gray-800 overflow-hidden\">\n        {events.length > 0 ? (\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead>\n                <tr className=\"border-b border-gray-700 bg-gray-900\">\n                  <th className=\"text-left text-gray-400 py-3 px-4\">ID</th>\n                  <th className=\"text-left text-gray-400 py-3 px-4\">タイトル</th>\n                  <th className=\"text-left text-gray-400 py-3 px-4\">アーティスト</th>\n                  <th className=\"text-left text-gray-400 py-3 px-4\">ステータス</th>\n                  <th className=\"text-left text-gray-400 py-3 px-4\">開始日時</th>\n                  <th className=\"text-right text-gray-400 py-3 px-4\">アクション</th>\n                </tr>\n              </thead>\n              <tbody>\n                {events.map((event) => (\n                  <tr key={event.id} className=\"border-b border-gray-800 hover:bg-gray-900\">\n                    <td className=\"py-3 px-4 text-gray-400\">#{event.id}</td>\n                    <td className=\"py-3 px-4 text-white font-bold\">\n                      {event.title}\n                    </td>\n                    <td className=\"py-3 px-4 text-gray-300\">\n                      {event.artist_name}\n                    </td>\n                    <td className=\"py-3 px-4\">\n                      <select\n                        value={event.status}\n                        onChange={(e) => handleStatusUpdate(event.id, e.target.value)}\n                        className={`px-3 py-1 rounded-full text-sm font-bold ${\n                          event.status === 'live'\n                            ? 'bg-red-600 text-white'\n                            : event.status === 'upcoming'\n                            ? 'bg-blue-600 text-white'\n                            : event.status === 'ended'\n                            ? 'bg-gray-600 text-white'\n                            : 'bg-green-600 text-white'\n                        }`}\n                      >\n                        <option value=\"upcoming\">配信予定</option>\n                        <option value=\"live\">配信中</option>\n                        <option value=\"ended\">終了</option>\n                        <option value=\"archived\">アーカイブ</option>\n                      </select>\n                    </td>\n                    <td className=\"py-3 px-4 text-gray-400 text-sm\">\n                      {event.start_time\n                        ? new Date(event.start_time).toLocaleString('ja-JP')\n                        : '未設定'}\n                    </td>\n                    <td className=\"py-3 px-4 text-right space-x-2\">\n                      <button\n                        onClick={() => {\n                          setEditingEvent(event);\n                          setShowModal(true);\n                        }}\n                        className=\"text-blue-400 hover:text-blue-300\"\n                      >\n                        <i className=\"fas fa-edit\"></i>\n                      </button>\n                      <button\n                        onClick={() => handleDelete(event.id)}\n                        className=\"text-red-400 hover:text-red-300\"\n                      >\n                        <i className=\"fas fa-trash\"></i>\n                      </button>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        ) : (\n          <div className=\"text-center py-12\">\n            <i className=\"fas fa-calendar-times text-gray-600 text-5xl mb-4\"></i>\n            <p className=\"text-gray-400\">イベントがありません</p>\n          </div>\n        )}\n      </div>\n\n      {showModal && (\n        <EventFormModal\n          event={editingEvent}\n          onClose={() => {\n            setShowModal(false);\n            setEditingEvent(null);\n          }}\n          onSuccess={() => {\n            setShowModal(false);\n            setEditingEvent(null);\n            fetchEvents();\n          }}\n        />\n      )}\n    </div>\n  );\n}\n\nfunction EventFormModal({\n  event,\n  onClose,\n  onSuccess,\n}: {\n  event: Event | null;\n  onClose: () => void;\n  onSuccess: () => void;\n}) {\n  const [artists, setArtists] = useState<Artist[]>([]);\n  const [formData, setFormData] = useState({\n    title: event?.title || '',\n    slug: event?.slug || '',\n    artist_id: '',\n    description: '',\n    thumbnail_url: '',\n    event_type: 'live',\n    stream_url: '',\n    archive_url: '',\n    start_time: event?.start_time ? new Date(event.start_time).toISOString().slice(0, 16) : '',\n    end_time: '',\n    status: event?.status || 'upcoming',\n  });\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    fetchArtists();\n  }, []);\n\n  const fetchArtists = async () => {\n    try {\n      const credentials = sessionStorage.getItem('admin_credentials');\n      const response = await fetch('/api/admin/artists', {\n        headers: {\n          'Authorization': `Basic ${credentials}`\n        }\n      });\n      const data = await response.json();\n      setArtists(Array.isArray(data) ? data : []);\n    } catch (error) {\n      console.error('Failed to fetch artists:', error);\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      const credentials = sessionStorage.getItem('admin_credentials');\n      const url = event \n        ? `/api/admin/events/${event.id}`\n        : '/api/admin/events';\n      \n      const method = event ? 'PATCH' : 'POST';\n\n      const response = await fetch(url, {\n        method,\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Basic ${credentials}`\n        },\n        body: JSON.stringify(formData),\n      });\n\n      if (response.ok) {\n        alert(event ? 'イベントを更新しました' : 'イベントを作成しました');\n        onSuccess();\n      } else {\n        const error = await response.json();\n        alert(`エラー: ${error.message || '保存に失敗しました'}`);\n      }\n    } catch (error) {\n      console.error('Submit error:', error);\n      alert('保存に失敗しました');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\n    const { name, value } = e.target;\n    setFormData(prev => ({\n      ...prev,\n      [name]: value,\n      // タイトルからslugを自動生成\n      ...(name === 'title' && !event ? { slug: value.toLowerCase().replace(/\\s+/g, '-').replace(/[^a-z0-9-]/g, '') } : {})\n    }));\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-gray-900 rounded-xl max-w-3xl w-full p-6 max-h-[90vh] overflow-y-auto\">\n        <h3 className=\"text-2xl font-bold text-white mb-6\">\n          <i className=\"fas fa-calendar-alt text-purple-500 mr-2\"></i>\n          {event ? 'イベント編集' : '新規イベント作成'}\n        </h3>\n\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                タイトル <span className=\"text-red-500\">*</span>\n              </label>\n              <input\n                type=\"text\"\n                name=\"title\"\n                value={formData.title}\n                onChange={handleChange}\n                required\n                className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                placeholder=\"イベント名を入力\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                スラッグ <span className=\"text-red-500\">*</span>\n              </label>\n              <input\n                type=\"text\"\n                name=\"slug\"\n                value={formData.slug}\n                onChange={handleChange}\n                required\n                className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                placeholder=\"event-slug\"\n              />\n            </div>\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n              アーティスト <span className=\"text-red-500\">*</span>\n            </label>\n            <select\n              name=\"artist_id\"\n              value={formData.artist_id}\n              onChange={handleChange}\n              required\n              className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n            >\n              <option value=\"\">アーティストを選択</option>\n              {artists.map(artist => (\n                <option key={artist.id} value={artist.id}>{artist.name}</option>\n              ))}\n            </select>\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n              説明\n            </label>\n            <textarea\n              name=\"description\"\n              value={formData.description}\n              onChange={handleChange}\n              rows={3}\n              className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n              placeholder=\"イベントの説明を入力\"\n            />\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                イベント種別\n              </label>\n              <select\n                name=\"event_type\"\n                value={formData.event_type}\n                onChange={handleChange}\n                className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n              >\n                <option value=\"live\">ライブ配信</option>\n                <option value=\"archive\">アーカイブ</option>\n              </select>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                ステータス\n              </label>\n              <select\n                name=\"status\"\n                value={formData.status}\n                onChange={handleChange}\n                className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n              >\n                <option value=\"upcoming\">配信予定</option>\n                <option value=\"live\">配信中</option>\n                <option value=\"ended\">終了</option>\n                <option value=\"archived\">アーカイブ</option>\n              </select>\n            </div>\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n              サムネイルURL\n            </label>\n            <input\n              type=\"url\"\n              name=\"thumbnail_url\"\n              value={formData.thumbnail_url}\n              onChange={handleChange}\n              className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n              placeholder=\"https://example.com/image.jpg\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n              ストリームURL\n            </label>\n            <input\n              type=\"url\"\n              name=\"stream_url\"\n              value={formData.stream_url}\n              onChange={handleChange}\n              className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n              placeholder=\"https://cloudfront.net/stream.m3u8\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n              アーカイブURL\n            </label>\n            <input\n              type=\"url\"\n              name=\"archive_url\"\n              value={formData.archive_url}\n              onChange={handleChange}\n              className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n              placeholder=\"https://cloudfront.net/archive.m3u8\"\n            />\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                開始日時 <span className=\"text-red-500\">*</span>\n              </label>\n              <input\n                type=\"datetime-local\"\n                name=\"start_time\"\n                value={formData.start_time}\n                onChange={handleChange}\n                required\n                className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                終了日時\n              </label>\n              <input\n                type=\"datetime-local\"\n                name=\"end_time\"\n                value={formData.end_time}\n                onChange={handleChange}\n                className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n              />\n            </div>\n          </div>\n\n          <div className=\"flex justify-end space-x-4 pt-4\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"px-6 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition\"\n            >\n              キャンセル\n            </button>\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              {loading ? (\n                <>\n                  <i className=\"fas fa-spinner fa-spin mr-2\"></i>\n                  保存中...\n                </>\n              ) : (\n                <>\n                  <i className=\"fas fa-save mr-2\"></i>\n                  {event ? '更新' : '作成'}\n                </>\n              )}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1053, "column": 0}, "map": {"version":3,"sources":["file:///home/user/webapp/components/admin/ArtistsManager.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\n\ninterface Artist {\n  id: number;\n  name: string;\n  slug: string;\n  bio?: string;\n  image_url?: string;\n}\n\nexport default function ArtistsManager() {\n  const [artists, setArtists] = useState<Artist[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showModal, setShowModal] = useState(false);\n  const [editingArtist, setEditingArtist] = useState<Artist | null>(null);\n\n  useEffect(() => {\n    fetchArtists();\n  }, []);\n\n  const fetchArtists = async () => {\n    try {\n      const credentials = sessionStorage.getItem('admin_credentials');\n      const response = await fetch('/api/admin/artists', {\n        headers: {\n          'Authorization': `Basic ${credentials}`\n        }\n      });\n      \n      if (!response.ok) {\n        throw new Error('Failed to fetch artists');\n      }\n      \n      const data = await response.json();\n      setArtists(Array.isArray(data) ? data : []);\n    } catch (error) {\n      console.error('Failed to fetch artists:', error);\n      setArtists([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDelete = async (id: number) => {\n    if (!confirm('このアーティストを削除してもよろしいですか？')) return;\n\n    try {\n      const credentials = sessionStorage.getItem('admin_credentials');\n      const response = await fetch(`/api/admin/artists/${id}`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Basic ${credentials}`\n        }\n      });\n\n      if (response.ok) {\n        fetchArtists();\n      } else {\n        alert('削除に失敗しました');\n      }\n    } catch (error) {\n      console.error('Delete error:', error);\n      alert('削除に失敗しました');\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"text-center py-8\">\n        <i className=\"fas fa-spinner fa-spin text-4xl text-purple-500 mb-4\"></i>\n        <p className=\"text-gray-300\">読み込み中...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-2xl font-bold text-white\">\n          <i className=\"fas fa-users text-purple-500 mr-2\"></i>\n          アーティスト管理\n        </h2>\n        <button \n          onClick={() => {\n            setEditingArtist(null);\n            setShowModal(true);\n          }}\n          className=\"bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-lg transition\"\n        >\n          <i className=\"fas fa-plus mr-2\"></i>\n          新規作成\n        </button>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {artists.map((artist) => (\n          <div\n            key={artist.id}\n            className=\"bg-black bg-opacity-40 backdrop-blur-md rounded-xl border border-gray-800 p-6\"\n          >\n            <div className=\"flex items-start justify-between mb-4\">\n              <div className=\"flex-1\">\n                <h3 className=\"text-xl font-bold text-white mb-1\">\n                  {artist.name}\n                </h3>\n                <p className=\"text-gray-400 text-sm\">@{artist.slug}</p>\n              </div>\n              <div className=\"flex space-x-2\">\n                <button \n                  onClick={() => {\n                    setEditingArtist(artist);\n                    setShowModal(true);\n                  }}\n                  className=\"text-blue-400 hover:text-blue-300\"\n                >\n                  <i className=\"fas fa-edit\"></i>\n                </button>\n                <button\n                  onClick={() => handleDelete(artist.id)}\n                  className=\"text-red-400 hover:text-red-300\"\n                >\n                  <i className=\"fas fa-trash\"></i>\n                </button>\n              </div>\n            </div>\n            {artist.image_url && (\n              <img \n                src={artist.image_url} \n                alt={artist.name}\n                className=\"w-full h-48 object-cover rounded-lg mb-4\"\n              />\n            )}\n            {artist.bio && (\n              <p className=\"text-gray-300 text-sm line-clamp-3\">{artist.bio}</p>\n            )}\n          </div>\n        ))}\n      </div>\n\n      {artists.length === 0 && (\n        <div className=\"text-center py-12 bg-black bg-opacity-40 backdrop-blur-md rounded-xl border border-gray-800\">\n          <i className=\"fas fa-users text-gray-600 text-5xl mb-4\"></i>\n          <p className=\"text-gray-400\">アーティストがいません</p>\n        </div>\n      )}\n\n      {showModal && (\n        <ArtistFormModal\n          artist={editingArtist}\n          onClose={() => {\n            setShowModal(false);\n            setEditingArtist(null);\n          }}\n          onSuccess={() => {\n            setShowModal(false);\n            setEditingArtist(null);\n            fetchArtists();\n          }}\n        />\n      )}\n    </div>\n  );\n}\n\nfunction ArtistFormModal({\n  artist,\n  onClose,\n  onSuccess,\n}: {\n  artist: Artist | null;\n  onClose: () => void;\n  onSuccess: () => void;\n}) {\n  const [formData, setFormData] = useState({\n    name: artist?.name || '',\n    slug: artist?.slug || '',\n    bio: artist?.bio || '',\n    image_url: artist?.image_url || '',\n  });\n  const [loading, setLoading] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      const credentials = sessionStorage.getItem('admin_credentials');\n      const url = artist \n        ? `/api/admin/artists/${artist.id}`\n        : '/api/admin/artists';\n      \n      const method = artist ? 'PATCH' : 'POST';\n\n      const response = await fetch(url, {\n        method,\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Basic ${credentials}`\n        },\n        body: JSON.stringify(formData),\n      });\n\n      if (response.ok) {\n        alert(artist ? 'アーティストを更新しました' : 'アーティストを作成しました');\n        onSuccess();\n      } else {\n        const error = await response.json();\n        alert(`エラー: ${error.message || '保存に失敗しました'}`);\n      }\n    } catch (error) {\n      console.error('Submit error:', error);\n      alert('保存に失敗しました');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n    const { name, value } = e.target;\n    setFormData(prev => ({\n      ...prev,\n      [name]: value,\n      // 名前からslugを自動生成\n      ...(name === 'name' && !artist ? { slug: value.toLowerCase().replace(/\\s+/g, '-').replace(/[^a-z0-9-]/g, '') } : {})\n    }));\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-gray-900 rounded-xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto\">\n        <h3 className=\"text-2xl font-bold text-white mb-6\">\n          <i className=\"fas fa-users text-purple-500 mr-2\"></i>\n          {artist ? 'アーティスト編集' : '新規アーティスト作成'}\n        </h3>\n\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n              アーティスト名 <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"text\"\n              name=\"name\"\n              value={formData.name}\n              onChange={handleChange}\n              required\n              className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n              placeholder=\"アーティスト名を入力\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n              スラッグ <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"text\"\n              name=\"slug\"\n              value={formData.slug}\n              onChange={handleChange}\n              required\n              className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n              placeholder=\"artist-slug\"\n            />\n            <p className=\"text-gray-500 text-xs mt-1\">\n              URL用の識別子（例: reirie）\n            </p>\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n              プロフィール\n            </label>\n            <textarea\n              name=\"bio\"\n              value={formData.bio}\n              onChange={handleChange}\n              rows={4}\n              className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n              placeholder=\"アーティストのプロフィールを入力\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n              画像URL\n            </label>\n            <input\n              type=\"url\"\n              name=\"image_url\"\n              value={formData.image_url}\n              onChange={handleChange}\n              className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n              placeholder=\"https://example.com/image.jpg\"\n            />\n          </div>\n\n          <div className=\"flex justify-end space-x-4 pt-4\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"px-6 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition\"\n            >\n              キャンセル\n            </button>\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              {loading ? (\n                <>\n                  <i className=\"fas fa-spinner fa-spin mr-2\"></i>\n                  保存中...\n                </>\n              ) : (\n                <>\n                  <i className=\"fas fa-save mr-2\"></i>\n                  {artist ? '更新' : '作成'}\n                </>\n              )}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAYe,SAAS;IACtB,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAW,EAAE;IACnD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,iNAAQ,EAAgB;IAElE,IAAA,kNAAS,EAAC;QACR;IACF,GAAG,EAAE;IAEL,MAAM,eAAe;QACnB,IAAI;YACF,MAAM,cAAc,eAAe,OAAO,CAAC;YAC3C,MAAM,WAAW,MAAM,MAAM,sBAAsB;gBACjD,SAAS;oBACP,iBAAiB,CAAC,MAAM,EAAE,aAAa;gBACzC;YACF;YAEA,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,MAAM,IAAI,MAAM;YAClB;YAEA,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,WAAW,MAAM,OAAO,CAAC,QAAQ,OAAO,EAAE;QAC5C,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,4BAA4B;YAC1C,WAAW,EAAE;QACf,SAAU;YACR,WAAW;QACb;IACF;IAEA,MAAM,eAAe,OAAO;QAC1B,IAAI,CAAC,QAAQ,2BAA2B;QAExC,IAAI;YACF,MAAM,cAAc,eAAe,OAAO,CAAC;YAC3C,MAAM,WAAW,MAAM,MAAM,CAAC,mBAAmB,EAAE,IAAI,EAAE;gBACvD,QAAQ;gBACR,SAAS;oBACP,iBAAiB,CAAC,MAAM,EAAE,aAAa;gBACzC;YACF;YAEA,IAAI,SAAS,EAAE,EAAE;gBACf;YACF,OAAO;gBACL,MAAM;YACR;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,iBAAiB;YAC/B,MAAM;QACR;IACF;IAEA,IAAI,SAAS;QACX,qBACE,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAE,WAAU;;;;;;8BACb,8OAAC;oBAAE,WAAU;8BAAgB;;;;;;;;;;;;IAGnC;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;;0CACZ,8OAAC;gCAAE,WAAU;;;;;;4BAAwC;;;;;;;kCAGvD,8OAAC;wBACC,SAAS;4BACP,iBAAiB;4BACjB,aAAa;wBACf;wBACA,WAAU;;0CAEV,8OAAC;gCAAE,WAAU;;;;;;4BAAuB;;;;;;;;;;;;;0BAKxC,8OAAC;gBAAI,WAAU;0BACZ,QAAQ,GAAG,CAAC,CAAC,uBACZ,8OAAC;wBAEC,WAAU;;0CAEV,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAI,WAAU;;0DACb,8OAAC;gDAAG,WAAU;0DACX,OAAO,IAAI;;;;;;0DAEd,8OAAC;gDAAE,WAAU;;oDAAwB;oDAAE,OAAO,IAAI;;;;;;;;;;;;;kDAEpD,8OAAC;wCAAI,WAAU;;0DACb,8OAAC;gDACC,SAAS;oDACP,iBAAiB;oDACjB,aAAa;gDACf;gDACA,WAAU;0DAEV,cAAA,8OAAC;oDAAE,WAAU;;;;;;;;;;;0DAEf,8OAAC;gDACC,SAAS,IAAM,aAAa,OAAO,EAAE;gDACrC,WAAU;0DAEV,cAAA,8OAAC;oDAAE,WAAU;;;;;;;;;;;;;;;;;;;;;;;4BAIlB,OAAO,SAAS,kBACf,8OAAC;gCACC,KAAK,OAAO,SAAS;gCACrB,KAAK,OAAO,IAAI;gCAChB,WAAU;;;;;;4BAGb,OAAO,GAAG,kBACT,8OAAC;gCAAE,WAAU;0CAAsC,OAAO,GAAG;;;;;;;uBApC1D,OAAO,EAAE;;;;;;;;;;YA0CnB,QAAQ,MAAM,KAAK,mBAClB,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAE,WAAU;;;;;;kCACb,8OAAC;wBAAE,WAAU;kCAAgB;;;;;;;;;;;;YAIhC,2BACC,8OAAC;gBACC,QAAQ;gBACR,SAAS;oBACP,aAAa;oBACb,iBAAiB;gBACnB;gBACA,WAAW;oBACT,aAAa;oBACb,iBAAiB;oBACjB;gBACF;;;;;;;;;;;;AAKV;AAEA,SAAS,gBAAgB,EACvB,MAAM,EACN,OAAO,EACP,SAAS,EAKV;IACC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAC;QACvC,MAAM,QAAQ,QAAQ;QACtB,MAAM,QAAQ,QAAQ;QACtB,KAAK,QAAQ,OAAO;QACpB,WAAW,QAAQ,aAAa;IAClC;IACA,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,MAAM,eAAe,OAAO;QAC1B,EAAE,cAAc;QAChB,WAAW;QAEX,IAAI;YACF,MAAM,cAAc,eAAe,OAAO,CAAC;YAC3C,MAAM,MAAM,SACR,CAAC,mBAAmB,EAAE,OAAO,EAAE,EAAE,GACjC;YAEJ,MAAM,SAAS,SAAS,UAAU;YAElC,MAAM,WAAW,MAAM,MAAM,KAAK;gBAChC;gBACA,SAAS;oBACP,gBAAgB;oBAChB,iBAAiB,CAAC,MAAM,EAAE,aAAa;gBACzC;gBACA,MAAM,KAAK,SAAS,CAAC;YACvB;YAEA,IAAI,SAAS,EAAE,EAAE;gBACf,MAAM,SAAS,kBAAkB;gBACjC;YACF,OAAO;gBACL,MAAM,QAAQ,MAAM,SAAS,IAAI;gBACjC,MAAM,CAAC,KAAK,EAAE,MAAM,OAAO,IAAI,aAAa;YAC9C;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,iBAAiB;YAC/B,MAAM;QACR,SAAU;YACR,WAAW;QACb;IACF;IAEA,MAAM,eAAe,CAAC;QACpB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,EAAE,MAAM;QAChC,YAAY,CAAA,OAAQ,CAAC;gBACnB,GAAG,IAAI;gBACP,CAAC,KAAK,EAAE;gBACR,gBAAgB;gBAChB,GAAI,SAAS,UAAU,CAAC,SAAS;oBAAE,MAAM,MAAM,WAAW,GAAG,OAAO,CAAC,QAAQ,KAAK,OAAO,CAAC,eAAe;gBAAI,IAAI,CAAC,CAAC;YACrH,CAAC;IACH;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAG,WAAU;;sCACZ,8OAAC;4BAAE,WAAU;;;;;;wBACZ,SAAS,aAAa;;;;;;;8BAGzB,8OAAC;oBAAK,UAAU;oBAAc,WAAU;;sCACtC,8OAAC;;8CACC,8OAAC;oCAAM,WAAU;;wCAA+C;sDACtD,8OAAC;4CAAK,WAAU;sDAAe;;;;;;;;;;;;8CAEzC,8OAAC;oCACC,MAAK;oCACL,MAAK;oCACL,OAAO,SAAS,IAAI;oCACpB,UAAU;oCACV,QAAQ;oCACR,WAAU;oCACV,aAAY;;;;;;;;;;;;sCAIhB,8OAAC;;8CACC,8OAAC;oCAAM,WAAU;;wCAA+C;sDACzD,8OAAC;4CAAK,WAAU;sDAAe;;;;;;;;;;;;8CAEtC,8OAAC;oCACC,MAAK;oCACL,MAAK;oCACL,OAAO,SAAS,IAAI;oCACpB,UAAU;oCACV,QAAQ;oCACR,WAAU;oCACV,aAAY;;;;;;8CAEd,8OAAC;oCAAE,WAAU;8CAA6B;;;;;;;;;;;;sCAK5C,8OAAC;;8CACC,8OAAC;oCAAM,WAAU;8CAA+C;;;;;;8CAGhE,8OAAC;oCACC,MAAK;oCACL,OAAO,SAAS,GAAG;oCACnB,UAAU;oCACV,MAAM;oCACN,WAAU;oCACV,aAAY;;;;;;;;;;;;sCAIhB,8OAAC;;8CACC,8OAAC;oCAAM,WAAU;8CAA+C;;;;;;8CAGhE,8OAAC;oCACC,MAAK;oCACL,MAAK;oCACL,OAAO,SAAS,SAAS;oCACzB,UAAU;oCACV,WAAU;oCACV,aAAY;;;;;;;;;;;;sCAIhB,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCACC,MAAK;oCACL,SAAS;oCACT,WAAU;8CACX;;;;;;8CAGD,8OAAC;oCACC,MAAK;oCACL,UAAU;oCACV,WAAU;8CAET,wBACC;;0DACE,8OAAC;gDAAE,WAAU;;;;;;4CAAkC;;qEAIjD;;0DACE,8OAAC;gDAAE,WAAU;;;;;;4CACZ,SAAS,OAAO;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AASnC"}},
    {"offset": {"line": 1634, "column": 0}, "map": {"version":3,"sources":["file:///home/user/webapp/components/admin/TicketsManager.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\n\ninterface Ticket {\n  id: number;\n  name: string;\n  price: number;\n  currency: string;\n  stock: number | null;\n  sold: number;\n  is_active: boolean;\n  event_title: string;\n  event_id: number;\n}\n\ninterface Event {\n  id: number;\n  title: string;\n}\n\nexport default function TicketsManager() {\n  const [tickets, setTickets] = useState<Ticket[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showModal, setShowModal] = useState(false);\n  const [editingTicket, setEditingTicket] = useState<Ticket | null>(null);\n\n  useEffect(() => {\n    fetchTickets();\n  }, []);\n\n  const fetchTickets = async () => {\n    try {\n      const credentials = sessionStorage.getItem('admin_credentials');\n      const response = await fetch('/api/admin/tickets', {\n        headers: {\n          'Authorization': `Basic ${credentials}`\n        }\n      });\n      \n      if (!response.ok) {\n        throw new Error('Failed to fetch tickets');\n      }\n      \n      const data = await response.json();\n      setTickets(Array.isArray(data) ? data : []);\n    } catch (error) {\n      console.error('Failed to fetch tickets:', error);\n      setTickets([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDelete = async (id: number) => {\n    if (!confirm('このチケットを削除してもよろしいですか？')) return;\n\n    try {\n      const credentials = sessionStorage.getItem('admin_credentials');\n      const response = await fetch(`/api/admin/tickets/${id}`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Basic ${credentials}`\n        }\n      });\n\n      if (response.ok) {\n        fetchTickets();\n      } else {\n        alert('削除に失敗しました');\n      }\n    } catch (error) {\n      console.error('Delete error:', error);\n      alert('削除に失敗しました');\n    }\n  };\n\n  const toggleActive = async (id: number, currentStatus: boolean) => {\n    try {\n      const credentials = sessionStorage.getItem('admin_credentials');\n      const response = await fetch(`/api/admin/tickets/${id}`, {\n        method: 'PATCH',\n        headers: { \n          'Content-Type': 'application/json',\n          'Authorization': `Basic ${credentials}`\n        },\n        body: JSON.stringify({ isActive: !currentStatus }),\n      });\n\n      if (response.ok) {\n        fetchTickets();\n      } else {\n        alert('更新に失敗しました');\n      }\n    } catch (error) {\n      console.error('Update error:', error);\n      alert('更新に失敗しました');\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"text-center py-8\">\n        <i className=\"fas fa-spinner fa-spin text-4xl text-purple-500 mb-4\"></i>\n        <p className=\"text-gray-300\">読み込み中...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-2xl font-bold text-white\">\n          <i className=\"fas fa-ticket-alt text-purple-500 mr-2\"></i>\n          チケット管理\n        </h2>\n        <button \n          onClick={() => {\n            setEditingTicket(null);\n            setShowModal(true);\n          }}\n          className=\"bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-lg transition\"\n        >\n          <i className=\"fas fa-plus mr-2\"></i>\n          新規作成\n        </button>\n      </div>\n\n      <div className=\"bg-black bg-opacity-40 backdrop-blur-md rounded-xl border border-gray-800 overflow-hidden\">\n        {tickets.length > 0 ? (\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead>\n                <tr className=\"border-b border-gray-700 bg-gray-900\">\n                  <th className=\"text-left text-gray-400 py-3 px-4\">ID</th>\n                  <th className=\"text-left text-gray-400 py-3 px-4\">チケット名</th>\n                  <th className=\"text-left text-gray-400 py-3 px-4\">イベント</th>\n                  <th className=\"text-left text-gray-400 py-3 px-4\">価格</th>\n                  <th className=\"text-left text-gray-400 py-3 px-4\">在庫</th>\n                  <th className=\"text-left text-gray-400 py-3 px-4\">販売数</th>\n                  <th className=\"text-left text-gray-400 py-3 px-4\">状態</th>\n                  <th className=\"text-right text-gray-400 py-3 px-4\">アクション</th>\n                </tr>\n              </thead>\n              <tbody>\n                {tickets.map((ticket) => (\n                  <tr key={ticket.id} className=\"border-b border-gray-800 hover:bg-gray-900\">\n                    <td className=\"py-3 px-4 text-gray-400\">#{ticket.id}</td>\n                    <td className=\"py-3 px-4 text-white font-bold\">{ticket.name}</td>\n                    <td className=\"py-3 px-4 text-gray-300\">{ticket.event_title}</td>\n                    <td className=\"py-3 px-4 text-gray-300\">\n                      ¥{(ticket.price / 100).toLocaleString()}\n                    </td>\n                    <td className=\"py-3 px-4 text-gray-300\">\n                      {ticket.stock !== null ? ticket.stock : '無制限'}\n                    </td>\n                    <td className=\"py-3 px-4 text-gray-300\">{ticket.sold}</td>\n                    <td className=\"py-3 px-4\">\n                      <button\n                        onClick={() => toggleActive(ticket.id, ticket.is_active)}\n                        className={`px-3 py-1 rounded-full text-xs font-bold ${\n                          ticket.is_active\n                            ? 'bg-green-600 text-white'\n                            : 'bg-gray-600 text-white'\n                        }`}\n                      >\n                        {ticket.is_active ? '販売中' : '停止中'}\n                      </button>\n                    </td>\n                    <td className=\"py-3 px-4 text-right space-x-2\">\n                      <button\n                        onClick={() => {\n                          setEditingTicket(ticket);\n                          setShowModal(true);\n                        }}\n                        className=\"text-blue-400 hover:text-blue-300\"\n                      >\n                        <i className=\"fas fa-edit\"></i>\n                      </button>\n                      <button\n                        onClick={() => handleDelete(ticket.id)}\n                        className=\"text-red-400 hover:text-red-300\"\n                      >\n                        <i className=\"fas fa-trash\"></i>\n                      </button>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        ) : (\n          <div className=\"text-center py-12\">\n            <i className=\"fas fa-ticket-alt text-gray-600 text-5xl mb-4\"></i>\n            <p className=\"text-gray-400\">チケットがありません</p>\n          </div>\n        )}\n      </div>\n\n      {showModal && (\n        <TicketFormModal\n          ticket={editingTicket}\n          onClose={() => {\n            setShowModal(false);\n            setEditingTicket(null);\n          }}\n          onSuccess={() => {\n            setShowModal(false);\n            setEditingTicket(null);\n            fetchTickets();\n          }}\n        />\n      )}\n    </div>\n  );\n}\n\nfunction TicketFormModal({\n  ticket,\n  onClose,\n  onSuccess,\n}: {\n  ticket: Ticket | null;\n  onClose: () => void;\n  onSuccess: () => void;\n}) {\n  const [events, setEvents] = useState<Event[]>([]);\n  const [formData, setFormData] = useState({\n    event_id: ticket?.event_id?.toString() || '',\n    name: ticket?.name || '',\n    description: '',\n    price: ticket ? (ticket.price / 100).toString() : '',\n    currency: ticket?.currency || 'jpy',\n    stock: ticket?.stock?.toString() || '',\n    sale_start: '',\n    sale_end: '',\n    is_active: ticket?.is_active ?? true,\n  });\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    fetchEvents();\n  }, []);\n\n  const fetchEvents = async () => {\n    try {\n      const credentials = sessionStorage.getItem('admin_credentials');\n      const response = await fetch('/api/admin/events', {\n        headers: {\n          'Authorization': `Basic ${credentials}`\n        }\n      });\n      const data = await response.json();\n      setEvents(Array.isArray(data) ? data : []);\n    } catch (error) {\n      console.error('Failed to fetch events:', error);\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      const credentials = sessionStorage.getItem('admin_credentials');\n      const url = ticket \n        ? `/api/admin/tickets/${ticket.id}`\n        : '/api/admin/tickets';\n      \n      const method = ticket ? 'PATCH' : 'POST';\n\n      // 価格を円から銭に変換\n      const priceInCents = Math.round(parseFloat(formData.price) * 100);\n\n      const response = await fetch(url, {\n        method,\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Basic ${credentials}`\n        },\n        body: JSON.stringify({\n          ...formData,\n          event_id: parseInt(formData.event_id),\n          price: priceInCents,\n          stock: formData.stock ? parseInt(formData.stock) : null,\n        }),\n      });\n\n      if (response.ok) {\n        alert(ticket ? 'チケットを更新しました' : 'チケットを作成しました');\n        onSuccess();\n      } else {\n        const error = await response.json();\n        alert(`エラー: ${error.message || '保存に失敗しました'}`);\n      }\n    } catch (error) {\n      console.error('Submit error:', error);\n      alert('保存に失敗しました');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\n    const { name, value, type } = e.target;\n    setFormData(prev => ({\n      ...prev,\n      [name]: type === 'checkbox' ? (e.target as HTMLInputElement).checked : value\n    }));\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-gray-900 rounded-xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto\">\n        <h3 className=\"text-2xl font-bold text-white mb-6\">\n          <i className=\"fas fa-ticket-alt text-purple-500 mr-2\"></i>\n          {ticket ? 'チケット編集' : '新規チケット作成'}\n        </h3>\n\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n              イベント <span className=\"text-red-500\">*</span>\n            </label>\n            <select\n              name=\"event_id\"\n              value={formData.event_id}\n              onChange={handleChange}\n              required\n              className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n            >\n              <option value=\"\">イベントを選択</option>\n              {events.map(event => (\n                <option key={event.id} value={event.id}>{event.title}</option>\n              ))}\n            </select>\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n              チケット名 <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"text\"\n              name=\"name\"\n              value={formData.name}\n              onChange={handleChange}\n              required\n              className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n              placeholder=\"一般チケット\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n              説明\n            </label>\n            <textarea\n              name=\"description\"\n              value={formData.description}\n              onChange={handleChange}\n              rows={3}\n              className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n              placeholder=\"チケットの説明を入力\"\n            />\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                価格（円） <span className=\"text-red-500\">*</span>\n              </label>\n              <input\n                type=\"number\"\n                name=\"price\"\n                value={formData.price}\n                onChange={handleChange}\n                required\n                min=\"0\"\n                step=\"1\"\n                className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                placeholder=\"3000\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                在庫数\n              </label>\n              <input\n                type=\"number\"\n                name=\"stock\"\n                value={formData.stock}\n                onChange={handleChange}\n                min=\"0\"\n                className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                placeholder=\"空欄で無制限\"\n              />\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                販売開始日時\n              </label>\n              <input\n                type=\"datetime-local\"\n                name=\"sale_start\"\n                value={formData.sale_start}\n                onChange={handleChange}\n                className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                販売終了日時\n              </label>\n              <input\n                type=\"datetime-local\"\n                name=\"sale_end\"\n                value={formData.sale_end}\n                onChange={handleChange}\n                className=\"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n              />\n            </div>\n          </div>\n\n          <div className=\"flex items-center\">\n            <input\n              type=\"checkbox\"\n              name=\"is_active\"\n              id=\"is_active\"\n              checked={formData.is_active}\n              onChange={handleChange}\n              className=\"w-4 h-4 text-purple-600 bg-gray-800 border-gray-700 rounded focus:ring-purple-500\"\n            />\n            <label htmlFor=\"is_active\" className=\"ml-2 text-sm text-gray-300\">\n              販売を有効にする\n            </label>\n          </div>\n\n          <div className=\"flex justify-end space-x-4 pt-4\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"px-6 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition\"\n            >\n              キャンセル\n            </button>\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              {loading ? (\n                <>\n                  <i className=\"fas fa-spinner fa-spin mr-2\"></i>\n                  保存中...\n                </>\n              ) : (\n                <>\n                  <i className=\"fas fa-save mr-2\"></i>\n                  {ticket ? '更新' : '作成'}\n                </>\n              )}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2532, "column": 0}, "map": {"version":3,"sources":["file:///home/user/webapp/components/admin/PurchasesView.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\nimport { format } from 'date-fns';\n\ninterface Purchase {\n  id: number;\n  event_id: number;\n  ticket_id: number;\n  stripe_customer_id: string;\n  customer_email: string;\n  customer_name: string;\n  amount: number;\n  currency: string;\n  status: string;\n  purchased_at: string;\n  event_title?: string;\n  ticket_name?: string;\n}\n\nexport default function PurchasesView() {\n  const [purchases, setPurchases] = useState<Purchase[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n\n  useEffect(() => {\n    fetchPurchases();\n  }, []);\n\n  const fetchPurchases = async () => {\n    try {\n      setLoading(true);\n      const credentials = sessionStorage.getItem('admin_credentials');\n      const response = await fetch('/api/admin/purchases', {\n        headers: {\n          'Authorization': `Basic ${credentials}`\n        }\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to fetch purchases');\n      }\n\n      const data = await response.json();\n      setPurchases(data);\n    } catch (err) {\n      setError('購入履歴の取得に失敗しました');\n      console.error('Failed to fetch purchases:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center items-center py-12\">\n        <div className=\"text-gray-400\">読み込み中...</div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"bg-red-500/10 border border-red-500 text-red-500 px-4 py-3 rounded-lg\">\n        {error}\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <div className=\"flex justify-between items-center mb-6\">\n        <h2 className=\"text-2xl font-bold text-white\">購入履歴</h2>\n        <button\n          onClick={fetchPurchases}\n          className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition\"\n        >\n          更新\n        </button>\n      </div>\n\n      {purchases.length === 0 ? (\n        <div className=\"text-center py-12 text-gray-400\">\n          購入履歴がありません\n        </div>\n      ) : (\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full\">\n            <thead>\n              <tr className=\"border-b border-gray-700\">\n                <th className=\"text-left py-3 px-4 text-gray-300 font-semibold\">ID</th>\n                <th className=\"text-left py-3 px-4 text-gray-300 font-semibold\">イベント</th>\n                <th className=\"text-left py-3 px-4 text-gray-300 font-semibold\">チケット</th>\n                <th className=\"text-left py-3 px-4 text-gray-300 font-semibold\">購入者</th>\n                <th className=\"text-left py-3 px-4 text-gray-300 font-semibold\">金額</th>\n                <th className=\"text-left py-3 px-4 text-gray-300 font-semibold\">ステータス</th>\n                <th className=\"text-left py-3 px-4 text-gray-300 font-semibold\">購入日時</th>\n              </tr>\n            </thead>\n            <tbody>\n              {purchases.map((purchase) => (\n                <tr key={purchase.id} className=\"border-b border-gray-700 hover:bg-gray-700/50\">\n                  <td className=\"py-3 px-4 text-gray-300\">{purchase.id}</td>\n                  <td className=\"py-3 px-4 text-gray-300\">{purchase.event_title || '-'}</td>\n                  <td className=\"py-3 px-4 text-gray-300\">{purchase.ticket_name || '-'}</td>\n                  <td className=\"py-3 px-4\">\n                    <div className=\"text-gray-300\">{purchase.customer_name}</div>\n                    <div className=\"text-sm text-gray-500\">{purchase.customer_email}</div>\n                  </td>\n                  <td className=\"py-3 px-4 text-gray-300\">\n                    ¥{(purchase.amount / 100).toLocaleString()}\n                  </td>\n                  <td className=\"py-3 px-4\">\n                    <span className={`px-2 py-1 rounded text-sm ${\n                      purchase.status === 'completed'\n                        ? 'bg-green-500/20 text-green-400'\n                        : purchase.status === 'pending'\n                        ? 'bg-yellow-500/20 text-yellow-400'\n                        : 'bg-red-500/20 text-red-400'\n                    }`}>\n                      {purchase.status === 'completed' ? '完了' :\n                       purchase.status === 'pending' ? '保留' : '失敗'}\n                    </span>\n                  </td>\n                  <td className=\"py-3 px-4 text-gray-300\">\n                    {format(new Date(purchase.purchased_at), 'yyyy/MM/dd HH:mm')}\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAoBe,SAAS;IACtB,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAa,EAAE;IACzD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;IAEnC,IAAA,kNAAS,EAAC;QACR;IACF,GAAG,EAAE;IAEL,MAAM,iBAAiB;QACrB,IAAI;YACF,WAAW;YACX,MAAM,cAAc,eAAe,OAAO,CAAC;YAC3C,MAAM,WAAW,MAAM,MAAM,wBAAwB;gBACnD,SAAS;oBACP,iBAAiB,CAAC,MAAM,EAAE,aAAa;gBACzC;YACF;YAEA,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,MAAM,IAAI,MAAM;YAClB;YAEA,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,aAAa;QACf,EAAE,OAAO,KAAK;YACZ,SAAS;YACT,QAAQ,KAAK,CAAC,8BAA8B;QAC9C,SAAU;YACR,WAAW;QACb;IACF;IAEA,IAAI,SAAS;QACX,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;0BAAgB;;;;;;;;;;;IAGrC;IAEA,IAAI,OAAO;QACT,qBACE,8OAAC;YAAI,WAAU;sBACZ;;;;;;IAGP;IAEA,qBACE,8OAAC;;0BACC,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;kCAAgC;;;;;;kCAC9C,8OAAC;wBACC,SAAS;wBACT,WAAU;kCACX;;;;;;;;;;;;YAKF,UAAU,MAAM,KAAK,kBACpB,8OAAC;gBAAI,WAAU;0BAAkC;;;;;qCAIjD,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBAAM,WAAU;;sCACf,8OAAC;sCACC,cAAA,8OAAC;gCAAG,WAAU;;kDACZ,8OAAC;wCAAG,WAAU;kDAAkD;;;;;;kDAChE,8OAAC;wCAAG,WAAU;kDAAkD;;;;;;kDAChE,8OAAC;wCAAG,WAAU;kDAAkD;;;;;;kDAChE,8OAAC;wCAAG,WAAU;kDAAkD;;;;;;kDAChE,8OAAC;wCAAG,WAAU;kDAAkD;;;;;;kDAChE,8OAAC;wCAAG,WAAU;kDAAkD;;;;;;kDAChE,8OAAC;wCAAG,WAAU;kDAAkD;;;;;;;;;;;;;;;;;sCAGpE,8OAAC;sCACE,UAAU,GAAG,CAAC,CAAC,yBACd,8OAAC;oCAAqB,WAAU;;sDAC9B,8OAAC;4CAAG,WAAU;sDAA2B,SAAS,EAAE;;;;;;sDACpD,8OAAC;4CAAG,WAAU;sDAA2B,SAAS,WAAW,IAAI;;;;;;sDACjE,8OAAC;4CAAG,WAAU;sDAA2B,SAAS,WAAW,IAAI;;;;;;sDACjE,8OAAC;4CAAG,WAAU;;8DACZ,8OAAC;oDAAI,WAAU;8DAAiB,SAAS,aAAa;;;;;;8DACtD,8OAAC;oDAAI,WAAU;8DAAyB,SAAS,cAAc;;;;;;;;;;;;sDAEjE,8OAAC;4CAAG,WAAU;;gDAA0B;gDACpC,CAAC,SAAS,MAAM,GAAG,GAAG,EAAE,cAAc;;;;;;;sDAE1C,8OAAC;4CAAG,WAAU;sDACZ,cAAA,8OAAC;gDAAK,WAAW,CAAC,0BAA0B,EAC1C,SAAS,MAAM,KAAK,cAChB,mCACA,SAAS,MAAM,KAAK,YACpB,qCACA,8BACJ;0DACC,SAAS,MAAM,KAAK,cAAc,OAClC,SAAS,MAAM,KAAK,YAAY,OAAO;;;;;;;;;;;sDAG5C,8OAAC;4CAAG,WAAU;sDACX,IAAA,+JAAM,EAAC,IAAI,KAAK,SAAS,YAAY,GAAG;;;;;;;mCAxBpC,SAAS,EAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkCpC"}},
    {"offset": {"line": 2829, "column": 0}, "map": {"version":3,"sources":["file:///home/user/webapp/app/admin/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\nimport EventsManager from '@/components/admin/EventsManager';\nimport ArtistsManager from '@/components/admin/ArtistsManager';\nimport TicketsManager from '@/components/admin/TicketsManager';\nimport PurchasesView from '@/components/admin/PurchasesView';\n\ninterface Stats {\n  totalSales: number;\n  totalPurchases: number;\n  totalEvents: number;\n  totalArtists: number;\n}\n\nexport default function AdminPage() {\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [username, setUsername] = useState('');\n  const [password, setPassword] = useState('');\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [activeTab, setActiveTab] = useState('dashboard');\n  const [stats, setStats] = useState<Stats | null>(null);\n\n  useEffect(() => {\n    // Check if already authenticated (from sessionStorage)\n    const authenticated = sessionStorage.getItem('admin_authenticated');\n    if (authenticated === 'true') {\n      setIsAuthenticated(true);\n      fetchStats();\n    }\n  }, []);\n\n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n    setLoading(true);\n\n    try {\n      const response = await fetch('/api/admin/auth', {\n        method: 'POST',\n        headers: {\n          'Authorization': 'Basic ' + btoa(`${username}:${password}`)\n        }\n      });\n\n      if (response.ok) {\n        sessionStorage.setItem('admin_authenticated', 'true');\n        sessionStorage.setItem('admin_credentials', btoa(`${username}:${password}`));\n        setIsAuthenticated(true);\n        fetchStats();\n      } else {\n        setError('認証に失敗しました。ユーザー名とパスワードを確認してください。');\n      }\n    } catch (err) {\n      setError('ログインエラーが発生しました');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleLogout = () => {\n    sessionStorage.removeItem('admin_authenticated');\n    sessionStorage.removeItem('admin_credentials');\n    setIsAuthenticated(false);\n    setUsername('');\n    setPassword('');\n  };\n\n  const fetchStats = async () => {\n    try {\n      const credentials = sessionStorage.getItem('admin_credentials');\n      const response = await fetch('/api/admin/stats', {\n        headers: {\n          'Authorization': `Basic ${credentials}`\n        }\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        setStats(data);\n      }\n    } catch (err) {\n      console.error('Failed to fetch stats:', err);\n    }\n  };\n\n  if (!isAuthenticated) {\n    return (\n      <div className=\"min-h-screen bg-gray-900 flex items-center justify-center px-4\">\n        <div className=\"max-w-md w-full bg-gray-800 rounded-lg shadow-xl p-8\">\n          <h1 className=\"text-3xl font-bold text-white mb-8 text-center\">\n            管理画面ログイン\n          </h1>\n          <form onSubmit={handleLogin} className=\"space-y-6\">\n            <div>\n              <label htmlFor=\"username\" className=\"block text-sm font-medium text-gray-300 mb-2\">\n                ユーザー名\n              </label>\n              <input\n                type=\"text\"\n                id=\"username\"\n                value={username}\n                onChange={(e) => setUsername(e.target.value)}\n                required\n                className=\"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                placeholder=\"admin\"\n              />\n            </div>\n            <div>\n              <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-300 mb-2\">\n                パスワード\n              </label>\n              <input\n                type=\"password\"\n                id=\"password\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                required\n                className=\"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n              />\n            </div>\n            {error && (\n              <div className=\"bg-red-500/10 border border-red-500 text-red-500 px-4 py-3 rounded-lg\">\n                {error}\n              </div>\n            )}\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              {loading ? 'ログイン中...' : 'ログイン'}\n            </button>\n          </form>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-900\">\n      <header className=\"bg-gray-800 border-b border-gray-700\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center\">\n          <h1 className=\"text-2xl font-bold text-white\">管理画面</h1>\n          <button\n            onClick={handleLogout}\n            className=\"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition\"\n          >\n            ログアウト\n          </button>\n        </div>\n      </header>\n\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Tab Navigation */}\n        <div className=\"bg-gray-800 rounded-lg p-1 mb-6 flex space-x-1\">\n          <button\n            onClick={() => setActiveTab('dashboard')}\n            className={`flex-1 py-3 px-4 rounded-lg font-medium transition ${\n              activeTab === 'dashboard'\n                ? 'bg-blue-600 text-white'\n                : 'text-gray-400 hover:text-white'\n            }`}\n          >\n            ダッシュボード\n          </button>\n          <button\n            onClick={() => setActiveTab('events')}\n            className={`flex-1 py-3 px-4 rounded-lg font-medium transition ${\n              activeTab === 'events'\n                ? 'bg-blue-600 text-white'\n                : 'text-gray-400 hover:text-white'\n            }`}\n          >\n            イベント管理\n          </button>\n          <button\n            onClick={() => setActiveTab('artists')}\n            className={`flex-1 py-3 px-4 rounded-lg font-medium transition ${\n              activeTab === 'artists'\n                ? 'bg-blue-600 text-white'\n                : 'text-gray-400 hover:text-white'\n            }`}\n          >\n            アーティスト管理\n          </button>\n          <button\n            onClick={() => setActiveTab('tickets')}\n            className={`flex-1 py-3 px-4 rounded-lg font-medium transition ${\n              activeTab === 'tickets'\n                ? 'bg-blue-600 text-white'\n                : 'text-gray-400 hover:text-white'\n            }`}\n          >\n            チケット管理\n          </button>\n          <button\n            onClick={() => setActiveTab('purchases')}\n            className={`flex-1 py-3 px-4 rounded-lg font-medium transition ${\n              activeTab === 'purchases'\n                ? 'bg-blue-600 text-white'\n                : 'text-gray-400 hover:text-white'\n            }`}\n          >\n            購入履歴\n          </button>\n        </div>\n\n        {/* Tab Content */}\n        <div className=\"bg-gray-800 rounded-lg p-6\">\n          {activeTab === 'dashboard' && (\n            <div>\n              <h2 className=\"text-2xl font-bold text-white mb-6\">統計情報</h2>\n              {stats ? (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n                  <div className=\"bg-gray-700 rounded-lg p-6\">\n                    <div className=\"text-gray-400 text-sm mb-2\">総売上</div>\n                    <div className=\"text-3xl font-bold text-white\">\n                      ¥{stats.totalSales.toLocaleString()}\n                    </div>\n                  </div>\n                  <div className=\"bg-gray-700 rounded-lg p-6\">\n                    <div className=\"text-gray-400 text-sm mb-2\">購入数</div>\n                    <div className=\"text-3xl font-bold text-white\">\n                      {stats.totalPurchases}\n                    </div>\n                  </div>\n                  <div className=\"bg-gray-700 rounded-lg p-6\">\n                    <div className=\"text-gray-400 text-sm mb-2\">イベント数</div>\n                    <div className=\"text-3xl font-bold text-white\">\n                      {stats.totalEvents}\n                    </div>\n                  </div>\n                  <div className=\"bg-gray-700 rounded-lg p-6\">\n                    <div className=\"text-gray-400 text-sm mb-2\">アーティスト数</div>\n                    <div className=\"text-3xl font-bold text-white\">\n                      {stats.totalArtists}\n                    </div>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"text-gray-400\">読み込み中...</div>\n              )}\n            </div>\n          )}\n\n          {activeTab === 'events' && <EventsManager />}\n          {activeTab === 'artists' && <ArtistsManager />}\n          {activeTab === 'tickets' && <TicketsManager />}\n          {activeTab === 'purchases' && <PurchasesView />}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}